<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>
<?import java.lang.String?>

<VBox xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.library.controller.ApproveRequestDialogController"
      styleClass="dialog-container" minWidth="500" maxWidth="600" prefWidth="550">
    
    <padding>
        <Insets top="20" right="20" bottom="15" left="20"/>
    </padding>
    
    <!-- Fixed Header (Not scrollable) -->
    <HBox alignment="CENTER_LEFT" spacing="12" styleClass="dialog-header">
        <Label text="âœ…" styleClass="dialog-icon"/>
        <VBox spacing="3">
            <Label text="Approve Borrow Request" styleClass="dialog-title"/>
            <Label text="Set borrowing parameters for this request" styleClass="dialog-subtitle"/>
        </VBox>
    </HBox>
    
    <Separator styleClass="dialog-separator">
        <VBox.margin>
            <Insets top="5" bottom="5"/>
        </VBox.margin>
    </Separator>

    <!-- Scrollable Content Area -->
    <ScrollPane fitToWidth="true" styleClass="form-scroll-pane"
                prefHeight="400" maxHeight="500" 
                hbarPolicy="NEVER" vbarPolicy="AS_NEEDED"
                VBox.vgrow="ALWAYS">
        <VBox spacing="15">
            <padding>
                <Insets top="5" right="8" bottom="5" left="5"/>
            </padding>
            
            <!-- Request Details (Read-only) -->
            <VBox spacing="12" styleClass="info-section">
                <padding>
                    <Insets topRightBottomLeft="15"/>
                </padding>

                <Label text="ðŸ“‹ Request Details" styleClass="info-section-title"/>

                <GridPane hgap="12" vgap="8">
                    <columnConstraints>
                        <ColumnConstraints minWidth="100" prefWidth="110"/>
                        <ColumnConstraints hgrow="ALWAYS"/>
                    </columnConstraints>

                    <Label text="Request ID:" GridPane.columnIndex="0" GridPane.rowIndex="0"
                           styleClass="info-label"/>
                    <Label fx:id="requestIdLabel" text="REQ-001" GridPane.columnIndex="1" GridPane.rowIndex="0"
                           styleClass="info-value"/>

                    <Label text="Member:" GridPane.columnIndex="0" GridPane.rowIndex="1"
                           styleClass="info-label"/>
                    <Label fx:id="memberNameLabel" text="John Doe" GridPane.columnIndex="1" GridPane.rowIndex="1"
                           styleClass="info-value"/>

                    <Label text="Book Title:" GridPane.columnIndex="0" GridPane.rowIndex="2"
                           styleClass="info-label"/>
                    <Label fx:id="bookTitleLabel" text="The Great Gatsby" GridPane.columnIndex="1" GridPane.rowIndex="2"
                           styleClass="info-value"/>

                    <Label text="Request Date:" GridPane.columnIndex="0" GridPane.rowIndex="3"
                           styleClass="info-label"/>
                    <Label fx:id="requestDateLabel" text="2025-12-31" GridPane.columnIndex="1" GridPane.rowIndex="3"
                           styleClass="info-value"/>
                </GridPane>
            </VBox>

            <Separator styleClass="section-divider"/>

            <!-- Borrowing Parameters -->
            <VBox spacing="12">
                <Label text="âš™ï¸ Set Borrowing Parameters" styleClass="section-header-with-icon"/>

                <!-- Borrow Duration -->
                <VBox spacing="6">
                    <HBox spacing="5" alignment="CENTER_LEFT">
                        <Label text="Borrow Duration (Days)" styleClass="field-label"/>
                        <Label text="*" styleClass="required-indicator"/>
                    </HBox>
                    <HBox spacing="12" alignment="CENTER_LEFT">
                        <Spinner fx:id="durationSpinner" min="1" max="90" initialValue="14"
                                 editable="true" prefWidth="120" styleClass="duration-spinner"/>
                        <Label text="ðŸ’¡ Standard: 14 days" styleClass="hint-text"/>
                    </HBox>
                    <Label fx:id="durationError" styleClass="error-label" managed="false" visible="false"/>
                </VBox>

                <!-- Return Date (Calculated) -->
                <VBox spacing="6">
                    <Label text="Expected Return Date" styleClass="field-label"/>
                    <HBox spacing="8" alignment="CENTER_LEFT">
                        <Label text="ðŸ“…" styleClass="field-icon"/>
                        <TextField fx:id="returnDateField" editable="false"
                                   HBox.hgrow="ALWAYS" styleClass="readonly-field"/>
                    </HBox>
                </VBox>

                <!-- Allow Renewal -->
                <VBox spacing="6">
                    <Label text="Renewal Options" styleClass="field-label"/>
                    <HBox styleClass="checkbox-container">
                        <padding>
                            <Insets topRightBottomLeft="8"/>
                        </padding>
                        <CheckBox fx:id="allowRenewalCheckbox" text="Allow member to renew this borrow"
                                  selected="true" styleClass="renewal-checkbox"/>
                    </HBox>
                </VBox>

                <!-- Notes/Comments -->
                <VBox spacing="6">
                    <Label text="Notes (Optional)" styleClass="field-label"/>
                    <TextArea fx:id="notesField" promptText="Add any special instructions or notes..."
                              prefRowCount="3" wrapText="true" styleClass="notes-area"/>
                    <Label text="ðŸ’¬ These notes will be visible to the member" styleClass="hint-text"/>
                </VBox>
            </VBox>

            <!-- General Error/Success Message -->
            <Label fx:id="generalMessage" wrapText="true" managed="false" visible="false"
                   styleClass="message-label"/>
            
            <!-- Spacer at bottom for better scrolling -->
            <Region prefHeight="10"/>
        </VBox>
    </ScrollPane>

    <!-- Fixed Footer (Not scrollable) -->
    <VBox spacing="8">
        <VBox.margin>
            <Insets top="10"/>
        </VBox.margin>
        
        <Separator styleClass="dialog-separator"/>
        
        <!-- Action Buttons -->
        <HBox spacing="10" alignment="CENTER_RIGHT" styleClass="dialog-button-bar">
            <Button fx:id="cancelButton" text="Cancel" onAction="#handleCancel"
                    styleClass="dialog-cancel-button" cancelButton="true"/>

            <Button fx:id="approveButton" text="âœ“ Approve &amp; Issue Book" onAction="#handleApprove"
                    defaultButton="true" styleClass="dialog-approve-button"/>
        </HBox>
    </VBox>

    <stylesheets>
        <String fx:value="/styles.css"/>
    </stylesheets>
</VBox>

<!-- 
Key Changes for Scrollability:
1. Moved header OUTSIDE ScrollPane (fixed at top)
2. Moved action buttons OUTSIDE ScrollPane (fixed at bottom)
3. Only form content is scrollable
4. Set prefHeight="400" and maxHeight="500" on ScrollPane
5. Added VBox.vgrow="ALWAYS" to ScrollPane for flexible height
6. Added dialog size constraints: minWidth="500" maxWidth="600" prefWidth="550"
7. Added separators between fixed and scrollable sections
8. Added bottom spacer (Region) for better scroll experience
9. Adjusted padding in scrollable area
10. Better visual separation between fixed and scrollable content

Benefits:
- Header always visible
- Buttons always accessible
- Content scrolls smoothly
- Dialog maintains reasonable size
- No overflow issues
- Better UX for long forms
-->